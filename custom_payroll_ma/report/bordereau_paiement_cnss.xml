<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="bordereau_paiement_cnss">
            <!--<t t-call= "hr_payroll_ma_legal_reports.external_layout_hr_reports" >-->
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <div class="header">

                    </div>
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="text-center">
                                <img src="custom_payroll_ma/static/src/img/cnss.png" style="width:100px;height:100px;"/>
                            </div>
                            <t t-set="total_base_plafonnne" t-value="0"/>
                            <t t-set="total_base_non_plafonnne" t-value="0"/>
                            <t t-foreach="o.slip_ids" t-as="b">

                                <t t-foreach="b.line_ids.filtered(lambda r: r.code in ('CNSSE','BRUT'))" t-as="line">
                                    <t t-if="line.code=='BRUT'">
                                         <t t-set="total_base_non_plafonnne" t-value="total_base_non_plafonnne+line.total"/>

                                    </t>
                                    <t t-if="line.code=='CNSSE'">
                                        <t t-set="total_base_plafonnne" t-value="total_base_plafonnne+line.amount"/>

                                    </t>


                                </t>
                            </t>


                            <h2 class="text-center">BORDEREAU DE PAIEMENT</h2>
                            <div class="container mt-3">
					<div class="row">
						<div class="col-6">
							<table class="table" style="border-collapse: collapse;">
								<tbody>
									<tr>
										<td>REFERENCE STRUCTURE</td>
										<td><span t-esc="o.company_id.reference_structure"/></td>
									</tr>
									<tr>
										<td>NUMERO D'AFFILIE</td>
										<td><span t-esc="o.company_id.n_affilie"/></td>
									</tr>
									<tr>
										<td>DATE D'EMISSION</td>
										<td> <span t-esc="o.date_start.strftime(&quot;%B, %Y&quot;)"/></td>
									</tr>
									<tr>
										<td>VERSEMENT DU MOIS DE</td>
										<td><span t-esc="o.date_start.strftime(&quot;%m/%Y&quot;)"/></td>
									</tr>
									<tr>
										<td>A REGULARISER AVANT LE</td>
                                        <td> <span t-field="o.date_payment"/> </td>
									</tr>
								</tbody>

				</table>
						</div>
						<div class="col-1"/>
						<div class="col-5  border border-dark">

						</div>
					</div>
					</div>


                            <br/>
                            <br/>
                            <br/>
                            <h5>BORDEREAU DE PAIEMENT C.N.S.S</h5>
					<hr/>
                            <table width="100%" style="border-collapse: collapse;">
                                <t t-set="total_final" t-value="0"/>
                                <t t-set="total" t-value="0"/>

                                <t t-set="total" t-value="0"/>
                                <t t-set="AF" t-value="1"/>
                                <t t-set="AF" t-value="AF*total_base_non_plafonnne*(o.taux_prestation_AF/100)"/>
                                <t t-set="total" t-value="total+AF"/>

                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-top: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Prestation A.F</h4>
                                    </td>
                                     <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%">
                                        <span t-esc="'%.2f'% total_base_non_plafonnne"/>
                                        x<span t-esc="'%.2f'% o.taux_prestation_AF"/>%
                                    </td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% AF"/>
                                    </td>
                                </tr>
                                <t t-set="AF" t-value="1"/>
                                <t t-set="AF" t-value="AF*total_base_plafonnne*(o.taux_prestation_sociales/100)"/>
                                <t t-set="total" t-value="total+AF"/>
                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-bottom: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Prestations sociales</h4>
                                    </td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%">
                                        <span t-esc="'%.2f'% total_base_plafonnne"/>
                                        x<span t-esc="'%.2f'% o.taux_prestation_sociales"/>%
                                    </td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% AF"/>
                                    </td>
                                </tr>
                                <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Total des cotisations versées</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% total"/>
                                    </td>
                                </tr>
                                <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Pénalités sur prestations sociales</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%"></td>
                                </tr>
                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-top: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Montant des A.F reversées</h4>
                                    </td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%"></td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%"></td>
                                </tr>
                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-bottom: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Pénalités sur A.F reversées</h4>
                                    </td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%"></td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%"></td>
                                </tr>
                                <t t-set="AF" t-value="1"/>
                                <t t-set="AF" t-value="AF*total_base_non_plafonnne*(o.taux_tfp/100)"/>
                                <t t-set="total" t-value="total+AF"/>
                               <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-top: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Taxe sur la formation professionnelle</h4>
                                    </td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%">
                                        <span t-esc="'%.2f'% total_base_non_plafonnne"/>
                                        x<span t-esc="'%.2f'% o.taux_tfp"/>%
                                    </td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% AF"/>
                                    </td>
                                </tr>
                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-bottom: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Pénalité sur taxe formation professionnelle</h4>
                                    </td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%"></td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%"></td>
                                </tr>
                                 <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Montant global du versement</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% total"/>
                                    </td>
                                </tr>
                            </table>
                            <t t-set="total_final" t-value="total_final+total"/>

                            <br/>
<h5>BORDEREAU DE PAIEMENT A.M.O</h5>
                            <hr/>
                            <table width="100%" style="border-collapse: collapse;">
                                <t t-set="total" t-value="0"/>
                                <t t-set="AF" t-value="1"/>
                                <t t-set="AF" t-value="AF*total_base_non_plafonnne*(o.taux_participation_amo/100)"/>
                                <t t-set="total" t-value="total+AF"/>

                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-top: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Participation A.M.O</h4>
                                    </td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%">
                                        <span t-esc="'%.2f'% total_base_non_plafonnne"/>
                                        x<span t-esc="'%.2f'% o.taux_participation_amo"/>%
                                    </td>
                                    <td style="border-top: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% AF"/>
                                    </td>
                                </tr>
                               <t t-set="AF" t-value="1"/>
                                <t t-set="AF" t-value="AF*total_base_non_plafonnne*(o.taux_cot_amo/100)"/>
                                <t t-set="total" t-value="total+AF"/>
                                <tr height="35">
                                    <td style="padding:5px;border-left: 1px solid black;border-bottom: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="40%">
                                        <h4>Cotisations A.M.O</h4>
                                    </td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="40%">
                                        <span t-esc="'%.2f'% total_base_non_plafonnne"/>
                                        x<span t-esc="'%.2f'% o.taux_cot_amo"/>%
                                    </td>
                                    <td style="border-bottom: 1px solid black;border-right: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% AF"/>
                                    </td>
                                </tr>
                                <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Total des cotisations versées A.M.O</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% total"/>
                                    </td>
                                </tr>
                                <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Pénalités sur cotisations versées A.M.O</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%"></td>
                                </tr>
                                <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Montant global du versement</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% total"/>
                                    </td>
                                </tr>
                                <t t-set="total_final" t-value="total_final+total"/>
                                <tr height="35">
                                    <td colspan="2"
                                        style="padding:5px;border: 1px solid black;text-align: left;vertical-align:middle;"
                                        width="80%">
                                        <h4>Total</h4>
                                    </td>
                                    <td style="border: 1px solid black;text-align: center;vertical-align:middle;"
                                        width="20%">
                                        <span t-esc="'%.2f'% total_final"/>
                                    </td>
                                </tr>
                            </table>
                            <br/>
                            <div align="left">
                                <h4>Arrêté le présent bordereau à la somme de : <span t-esc="o.currency_id.amount_to_text(total_final)"/></h4>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>

    </data>
</odoo>